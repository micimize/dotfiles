{
  "name": "Dotfiles Iteration",
  // Minimal devcontainer for safe dotfile development and iteration.
  // Not a full development environment - just shell, git, and text editing.
  // Uses wezterm-server for lace dogfooding.
  "image": "mcr.microsoft.com/devcontainers/base:ubuntu",
  "features": {
    // Core tools for dotfile development
    "ghcr.io/devcontainers/features/git:1": {},
    // SSH for wezterm domain multiplexing
    "ghcr.io/devcontainers/features/sshd:1": {},
    // Wezterm server for lace dogfooding
    "ghcr.io/weftwiseink/devcontainer-features/wezterm-server:1": {
      "version": "20240203-110809-5046fc22"
    }
  },
  // Expose sshd port for WezTerm SSH domain multiplexing
  // Uses port 2223 to avoid conflict with lace devcontainer (port 2222)
  "appPort": ["2223:2222"],
  "mounts": [
    // SSH public key for WezTerm SSH domain access (host -> container)
    // One-time setup: ssh-keygen -t ed25519 -f ~/.ssh/dotfiles_devcontainer -N ""
    "source=${localEnv:HOME}/.ssh/dotfiles_devcontainer.pub,target=/home/vscode/.ssh/authorized_keys,type=bind,readonly"
  ],
  // Start wezterm mux daemon for SSH domain multiplexing (sshd is started by the sshd feature)
  "postStartCommand": "wezterm-mux-server --daemonize 2>/dev/null || true",
  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash"
      }
    },
    // Lace plugins - mounted at /mnt/lace/plugins/<name>
    // This enables the wezterm config to load the lace plugin from a consistent path
    "lace": {
      "plugins": {
        // Lace repo provides the wezterm plugin for devcontainer SSH domain access
        "github.com/weftwiseink/lace": {}
      }
    }
  }
}
