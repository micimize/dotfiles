/*
 * Assuming OSX dark theme and compact nav using sidebery
 * Should be readily customizable for whatever setup.
 * To inspect browser elements, you'll want to:
 * - Enable browser chrome and add-on debugging toolboxes in dev tools 
 * - Enable remote debugging
 * - Go to Tools > Developer > Browser Toolbox (not Browser console)
 * Editing browser elements through the debugger seems buggy at times,
 * especially colors
 * 
 */

/* TODO https://caniuse.com/css-nesting */


#sidebar {
  max-width: none !important;
  min-width: 0px !important;
}

/* show window controls */
#toolbar-menubar {
  visibility: visible !important;
  width: 75px !important;
  height: 0px !important;

  hbox.titlebar-buttonbox-container {
    position: absolute;
    margin-top: 6px;
    margin-left: -3px;
  }
}



#main-window:not(#main-window[privatebrowsingmode]) {
  /* Hide tab bar because we're using sidebar tabs */
  #TabsToolbar {
    visibility: collapse!important;
  }

  #sidebar-button[checked="true"] {
    visibility: hidden;
  }

  /*
  * Use the navbar ordering "<-", "->", "sidebar button", "refresh
  * This css will pull the sidebery button out and over the sidebar button when active,
  * while still surfacing the sidebar button when inactive
  */
  #nav-bar toolbarspring:first-child {
    max-width: 75px !important;
    width: 75px !important;
    min-width: 75px !important;
  }

  /* Move sidebar header button into navbar */
  #sidebar-header {
    z-index: 3;
    /* Make the header button the size of the nav bar button and transparent */
    position: fixed !important;
    margin-left: 72px !important;
    margin-top: -27px !important;
    padding-top: 2px !important;
    background-color: transparent;
    padding-bottom: 0px !important;
    margin-bottom: 4px !important;
    width: 30px !important;
    height: 24px !important;
    pointer-events: none;
    border-color: transparent !important;

    /* Hide text and close button from sidebar header */
    > #sidebar-switcher-target > *:not(:first-child),
    > #sidebar-close {
      visibility: collapse !important;
    }

    /*
    * Make the header button the size of the nav bar button,
    * use a fitting color for the background
    * fix color as black because the treetab image is fixed color
    *
    * because sidebar header sizing can't be controlled,
    * we need to pass pointer events to <- -> buttons.
    * thus the pointer-events
    */
    > #sidebar-switcher-target {
      opacity: 1;
      /*! filter: opacity(1); */
      /* width: 32px !important; height: 32px !important; */
      padding: 3px !important;
      /*
      * because sidebar header sizing can't be controlled,
      * we need to pass pointer events to <- -> buttons
      */
      pointer-events: all;
      background-color: var(--input-bgcolor, var(--toolbar-bgcolor))!important;
      z-index: 3;
    }
    > #sidebar-switcher-target:hover {
      background-color:  var(--toolbarbutton-hover-background) !important;
    }

    > #sidebar-switcher-target image {
      filter: brightness(180%);
    }

  }
}

#sidebar-splitter {
  border-right: 2px solid black !important;
  border-left: 4px solid black !important;
  transition: border-color 0.25s cubic-bezier(0.07, 0.95, 0, 1);

  &:hover {
    border-left-color: rgb(31, 31, 31) !important;
  }

  &:active {
    border-color: rgb(62, 62, 62) !important;
  }
}
/* TODO idk where this issue came from but was super annoying */
#urlbar-container {
  height: 28px !important;
  max-height: 28px !important;
  --urlbar-container-height: 28px !important;
}
hbox#urlbar {
  transition: font-size 0.125s ease-in-out;
   /*#urlbar-background {
     transition: background-color 0.1s;
  }*/
  align-items: center;
  box[role="button"] {
    /*background-color: var(--toolbar-bgcolor);*/
    z-index: 2;
    min-width: 22px;
    min-height: 24px;
    > box {
      align-items: center;
      width: auto;
      height: auto;
    }
    image {
      transition: 0.125s;
      max-width: 16px!important;
      max-height: 16px!important;
    }
    align-self: center;
  }
  #urlbar-input {
    transition: margin-left 0.125s ease-in-out;
    margin-left: 0px;
  }
  &:not(:active, :focus, :focus-within) {
    font-size: 12px!important;
    #urlbar-background {
      background-color: var(--toolbar-bgcolor)!important;
    }
    box[role="button"]:not(:active, :hover, [open="true"]) {
      image {
        opacity: 0.3;
        max-width: 12px!important;
        max-height: 12px!important;
      }
    }
  }
  /* Hide https:// - we already have a lock icon */
  .urlbar-input-box {
    overflow: clip;
  }
  #urlbar-input { 
    margin-left: calc(var(--urlbar-scheme-size) * -0.66) !important;
  } 
}

toolbar#nav-bar {
  height: 28px;
  --toolbarbutton-inner-padding: 4px;
  .urlbar-page-action,
  .chromeclass-toolbar-additional:not(#sidebar-button, #back-button, #forward-button) {
    transition: 0.125s ease-in-out;
    &:not(.urlbar-page-action) {
      margin-top: -3px!important;
      image { max-height: 22px; }
    }
    image {
      transition: 0.125s ease-in-out;
      scale: 1.1;
    }
    opacity: 1.0!important;
    height: 34px; /* this + scale focus on image prevents weird nested menu wiggling */
    max-width: 24px !important;
    .toolbarbutton-badge {
      opacity: 1!important;
      background-color: transparent!important;
      border: none!important;
      box-shadow: none!important;
      position: relative;
      top: 2px;
    }

    &:not(:hover, :active, :focus, :focus-within, [open="true"]) {
      > image, > :not(toolbarbutton) image, toolbarbutton:not([open="true"]) image {
        scale: 0.75;
        /*! transform-origin: bottom; */
      }
    }
  }
  
  &:not(:hover, :active, :focus, :focus-within) {
    .urlbar-page-action,
    .chromeclass-toolbar-additional:not(#sidebar-button, #back-button, #forward-button)
     {
      opacity: 0.4!important;
      .toolbarbutton-badge {
        opacity: 0!important;
      }
    }
  }
  #PanelUI-button {}
}